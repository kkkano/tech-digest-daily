name: GitHub Trending Daily

on:
  # æ¯å¤© UTC 0:00 è¿è¡Œ = åŒ—äº¬æ—¶é—´ 8:00
  schedule:
    - cron: '0 0 * * *'

  # æ‰‹åŠ¨è§¦å‘ï¼ˆç”¨äºæµ‹è¯•ï¼‰
  workflow_dispatch:
    inputs:
      limit:
        description: 'è·å–é¡¹ç›®æ•°é‡'
        required: false
        default: '25'
      language:
        description: 'è¯­è¨€ç­›é€‰ï¼ˆç•™ç©º=å…¨éƒ¨ï¼‰'
        required: false
        default: ''

jobs:
  send-trending:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: ğŸ è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          pip install -r requirements.txt

      - name: ğŸš€ è·å–è¶‹åŠ¿å¹¶å‘é€é‚®ä»¶
        env:
          TO_EMAIL: ${{ secrets.TO_EMAIL }}
          RESEND_API_KEY: ${{ secrets.RESEND_API_KEY }}
          # å¯é€‰ï¼šä½¿ç”¨ SMTP æ›¿ä»£ Resend
          # SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
          # SMTP_PORT: ${{ secrets.SMTP_PORT }}
          # SMTP_USER: ${{ secrets.SMTP_USER }}
          # SMTP_PASSWORD: ${{ secrets.SMTP_PASSWORD }}
          REPO_LIMIT: ${{ github.event.inputs.limit || '25' }}
          LANGUAGE_FILTER: ${{ github.event.inputs.language || '' }}
        run: |
          cd src
          python main.py

      - name: ğŸ“Š ä»»åŠ¡çŠ¶æ€
        if: always()
        run: |
          echo "ä»»åŠ¡å®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S UTC')"
